-- Combined script with no UI

local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local VirtualInputManager = game:GetService("VirtualInputManager")

-- Function to unequip all pets
local function unequipAllPets()
    local petsFolder = LocalPlayer.petsFolder
    for _, folder in pairs(petsFolder:GetChildren()) do
        if folder:IsA("Folder") then
            for _, pet in pairs(folder:GetChildren()) do
                ReplicatedStorage.rEvents.equipPetEvent:FireServer("unequipPet", pet)
            end
        end
    end
    task.wait(0.1)
end

-- Function to equip specific pet
local function equipPet(petName)
    unequipAllPets()
    task.wait(0.01)
    for _, pet in pairs(LocalPlayer.petsFolder.Unique:GetChildren()) do
        if pet.Name == petName then
            ReplicatedStorage.rEvents.equipPetEvent:FireServer("equipPet", pet)
        end
    end
end

-- Function to find machine
local function findMachine(machineName)
    local machine = workspace.machinesFolder:FindFirstChild(machineName)
    if not machine then
        for _, folder in pairs(workspace:GetChildren()) do
            if folder:IsA("Folder") and folder.Name:find("machines") then
                machine = folder:FindFirstChild(machineName)
                if machine then break end
            end
        end
    end
    return machine
end

-- Function to press E key
local function pressE()
    VirtualInputManager:SendKeyEvent(true, "E", false, game)
    task.wait(0.1)
    VirtualInputManager:SendKeyEvent(false, "E", false, game)
end

-- Egg cooldown settings
_G.EggCooldown = 1800 -- 30 minutes cooldown
_G.LastEggTime = 0

-- Function to check egg cooldown status and use protein egg if needed
local function checkAndUseProteinEgg()
    local timeSinceLastEgg = os.time() - _G.LastEggTime
    local timeRemaining = _G.EggCooldown - timeSinceLastEgg
    
    -- If between 28-30 minutes remaining (just used recently), skip using egg
    if timeRemaining >= 0 and timeRemaining <= 120 then
        print("Egg cooldown is between 28-30 minutes remaining. Skipping egg use.")
        return false
    end
    
    -- If cooldown has elapsed (30+ minutes), use an egg
    if timeSinceLastEgg >= _G.EggCooldown then
        local proteinEgg = LocalPlayer.Backpack:FindFirstChild("Protein Egg")
        if proteinEgg then
            -- Equip the egg
            proteinEgg.Parent = LocalPlayer.Character
            task.wait(0.5) -- Wait longer to ensure it's equipped
            
            -- Get screen center position
            local screenSize = workspace.CurrentCamera.ViewportSize
            local centerX = screenSize.X / 2
            local centerY = screenSize.Y / 2
            
            -- Click multiple times to ensure the egg is used
            for i = 1, 3 do
                -- Send mouse events to the center of the screen
                VirtualInputManager:SendMouseButtonEvent(centerX, centerY, 0, true, game, 1)
                task.wait(0.1)
                VirtualInputManager:SendMouseButtonEvent(centerX, centerY, 0, false, game, 1)
                task.wait(0.2)
            end
            
            _G.LastEggTime = os.time()
            print("Used 1 Protein Egg. Next egg will be available in 30 minutes.")
            task.wait(1) -- Wait longer after using the egg
            return true
        else
            print("No Protein Egg found in backpack.")
        end
    else
        local minutesRemaining = math.floor(timeRemaining / 60)
        local secondsRemaining = timeRemaining % 60
        print("Egg cooldown: " .. minutesRemaining .. " minutes and " .. secondsRemaining .. " seconds remaining.")
    end
    
    return false
end

-- Hide all frames
task.spawn(function()
    for _, obj in pairs(ReplicatedStorage:GetChildren()) do
        if obj.Name:match("Frame$") then
            obj.Visible = false
        end
    end
end)

-- Auto rebirth system
task.spawn(function()
    while true do
        local rebirthsValue = LocalPlayer.leaderstats.Rebirths.Value
        local strengthNeeded = 10000 + (5000 * rebirthsValue)
        
        if LocalPlayer.ultimatesFolder:FindFirstChild("Golden Rebirth") then
            local goldenRebirthValue = LocalPlayer.ultimatesFolder["Golden Rebirth"].Value
            strengthNeeded = math.floor(strengthNeeded * (1 - (goldenRebirthValue * 0.1)))
        end
        
        unequipAllPets()
        task.wait(0.1)
        equipPet("Swift Samurai")
        
        while LocalPlayer.leaderstats.Strength.Value < strengthNeeded do
            for i = 1, 10 do
                LocalPlayer.muscleEvent:FireServer("rep")
            end
            task.wait()
        end
        
        unequipAllPets()
        task.wait(0.1)
        equipPet("Tribal Overlord")
        
        -- Check and use protein egg before teleporting if needed
        checkAndUseProteinEgg()
        
        local jungleBar = findMachine("Jungle Bar Lift")
        if jungleBar and jungleBar:FindFirstChild("interactSeat") then
            LocalPlayer.Character.HumanoidRootPart.CFrame = jungleBar.interactSeat.CFrame * CFrame.new(0, 3, 0)
            repeat
                task.wait(0.1)
                pressE()
            until LocalPlayer.Character.Humanoid.Sit
        end
        
        local currentRebirths = LocalPlayer.leaderstats.Rebirths.Value
        repeat
            ReplicatedStorage.rEvents.rebirthRemote:InvokeServer("rebirthRequest")
            task.wait(0.1)
        until LocalPlayer.leaderstats.Rebirths.Value > currentRebirths
        
        task.wait()
    end
end)
